# 加载内核

​		

由于内核是使用C语言来编写的。将C语言编译为目标文件后，也就是使用

```shell
gcc -c ..
```

此时编译后的文件是目标文件，也叫作待重定位文件，待重定位文件是文件里面的符号还没有编址的文件，这些符号的地址需要和其他的目标文件组成一个可执行文件再来编排地址。这里所说的组成就是链接的过程，而在linux中，可以使用ld命令来链接多个目标文件，并且可以指定可执行文件的起始虚拟地址。

## ELF格式

在linux下，被链接后的可执行文件格式是ELF格式，也就是(Executeable and Linkable Format)，可执行链接格式。

想要加载使用C语言编写的内核程序，首先需要编译，然后链接成可执行文件，这样才能读取此文件到内存中进行加载，但是我们需要读取此可执行文件之前，必须要了解ELF格式。

<img src="img/elf.png">



### e-ident-16字节

| e-ident[0-3]=[0x7f,'e','l','f'] | elf文件的魔数                                                |
| ------------------------------- | ------------------------------------------------------------ |
| e-ident[4]                      | 表示elf文件的类型，为0代表不可识别，为1代表是32位可执行文件，为2代表64位可执行文件 |
| e-indet[5]                      | 是大端字节还是小端字节                                       |
| e-ident[6]                      | elf的版本信息，0位非法版本，1位合法版本                      |
| e-ident[7-15]                   | 保留                                                         |



### e-type-2字节

| elf目标文件类型 | 取值 | 意义             |
| --------------- | ---- | ---------------- |
| ET_NONE         | 0    | 未知目标文件     |
| ET_REL          | 1    | 可重定位文件     |
| ET_EXEC         | 2    | 可执行文件       |
| ET_DYN          | 3    | 动态共享目标文件 |



### e-machine-2字节

| 体系结构类型 | 取值 | 意义              |
| ------------ | ---- | ----------------- |
| EM_M386      | 3    | intel 80386可运行 |
| EM_860       | 7    | Intel 80860可运行 |

