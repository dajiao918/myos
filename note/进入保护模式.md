# 进入保护模式



## 为什么要进入保护模式呢？

1. 8086CPU的运行模式被称为实模式

2. 由于在8086横行的时候，CPU只能寻址1MB的地址空间，当地址超过了FFFFF的时候，就会形成地址回绕，也就是从0开始。随着计算机的发展，后来CPU的寻址空间也在增大，可是计算机行业之所以能如火朝天的原因之一就是向下兼容，所以为了兼容1MB地址环绕的特性，IBM公司设置了一个A20gate来控制A20地址线，当A20gate被禁止时，只能访问1MB的内存。所以在实模式下，计算机只能访问1MB的内存，这是不可忍受的。
3. 在实模式下，地址的访问方式是段基址加上偏移地址，形成后的地址就是物理地址，也就是说程序员是可以指哪打哪，想访问那个内存就访问那个内存。
4. 实模式下没有特权级的区分，用户程序和操作系统属于一个等级，操作系统很危险。。。



## 进入保护模式的三个步骤：

1. 打开A20地址线，只有打开了A20地址线，才能访问1MB之外的内存
2. 加载GDT全局描述符表，在保护模式下，访问地址和实模式下有了一些区别，虽然都是以段基址加上偏移地址形成的线性地址，但是保护模式提供了全局描述符表(Global Descriptor Table)，要想使用段，必须要提前将段定义好，组装成段描述符，加载到gdt当中，最后根据段选择子来获取GDT的描述符，形成段基址，加上偏移地址才是线性地址。所以在保护模式下，没有加载GDT，程序将寸步难行。
3. 打开寄存器CR0的PE位(第0位)

